# Media Display environment configuration (section-based)
# Each block is marked by [SectionName] followed by KEY=VALUE pairs.
# Copy to app/assets/env/.env for local development

# =============================================================================
# Environment Configuration
# =============================================================================
[Environment]
# dev | prod
FLAVOR=dev
# Override detected platform for priority parsing; leave blank to auto-detect (web, macos, windows, linux, android, ios, embedded)
PLATFORM_MODE=

# =============================================================================
# Server Configuration: server URL, logging, SSL, etc.
# =============================================================================
[Server]
LOG_LEVEL=ALL # ALL, FINE, DEBUG, INFO, WARNING, SEVERE, OFF
# Base URL for API calls (no trailing slash);
API_BASE_URL=http://localhost:5001
# Whether to verify SSL certificates when connecting to the API; set to false if using self-signed certs in development
API_SSL_VERIFY=true
# Maximum number of avatars per user
MAX_AVATARS_PER_USER=6

# =============================================================================
# WebSocket Configuration: connection URL, retry logic, etc.
# =============================================================================
[WebSocket]
# Base URL for WebSocket connection to receive real-time updates; no trailing slash; ws:// for dev, wss:// for prod
BASE_URL=ws://localhost:5002/events/media
# Whether to verify SSL certificates when connecting to the WebSocket; set to false if using self-signed certs in development
SSL_VERIFY=true
# WebSocket retry logic: if the connection drops, how aggressively should the client try to reconnect? Adjust based on expected connection stability and server load tolerance.
RETRY_INTERVAL_MS=3000

RETRY_ACTIVE_SEC=60

# If the connection has been dropping for longer than this total time, stop retrying and wait for user to manually refresh the page. Set to 0 to retry indefinitely.
RETRY_WINDOW_SEC=1800
# After the retry window is exceeded, wait this long before allowing retries again. Set to 0 to allow immediate retries after window expires.
RETRY_COOLDOWN_SEC=60
# If the connection has been idle (no messages received) for this long, force a reconnect to ensure the client is still receiving updates. Set to 0 to disable idle reconnection.
FORCE_RECONN_IDLE_SEC=300

# =============================================================================
# Service Configuration: polling intervals, fallback logic, priority orders, etc.
# =============================================================================
[GeneralService]
# How long to wait after Spotify reports paused before switching to next service
SPOTIFY_PAUSED_WAIT_SEC=5
# Enable automatic service cycling when a service reports not playing and all others are also not playing; relies on service-specific fallback logic to trigger cycling
ENABLE_CYCLING=true
# After checking all services and none are playing, wait this long before cycling again
CYCLE_RESET_SEC=7
# Grace period during service transitions to avoid UI flicker
TRANSITION_GRACE_SEC=2
# The time to wait before resetting all services when music hasn't been playing. Set to 0 to disable reseting on idle.
IDLE_CYCLE_RESET_SEC=300
# If a service reports "not playing" for this long, reset all services and start discovery over. This is a safety net in case the server misses a "playing" event or a service gets stuck in a bad state. # Best to set the time longer than a typical song duration (< 6 minutes to avoid false positives, but ideally not much longer than average song length of ~3-4 minutes)
IDLE_TIME_SEC=360

# =============================================================================
# Service Priority Configuration: API endpoints, timeouts, retry logic, etc.
# =============================================================================
[ServicePriority]
# Define the priority order of services for each platform. The client will try to use the highest-priority service that is currently playing music. Services not listed for a platform will be ignored on that platform. The "default" key is used if a platform-specific key is not defined.
# Available services: direct_spotify, cloud_spotify, local_sonos, native_local_sonos (native_local_sonos is only for platforms that support the native Sonos bridge)
DEFAULT=direct_spotify,cloud_spotify
WEB=direct_spotify,cloud_spotify
MACOS=native_local_sonos,direct_spotify,cloud_spotify
WINDOWS=native_local_sonos,direct_spotify,cloud_spotify
LINUX=native_local_sonos,direct_spotify,cloud_spotify
ANDROID=native_local_sonos,direct_spotify,cloud_spotify
IOS=native_local_sonos,direct_spotify,cloud_spotify
EMBEDDED=native_local_sonos,direct_spotify,cloud_spotify

# =============================================================================
# Direct Spotify Configuration: API endpoints, timeouts, retry logic, etc.
# =============================================================================
[DirectSpotify]
# Spotify API base URL (used for direct Spotify integration); can be overridden in conf/{env}.json if needed
API_BASE_URL=https://api.spotify.com/v1
# Whether to verify SSL certificates when connecting to Spotify API; set to false if using self-signed certs in development
API_SSL_VERIFY=true
# Time to wait for Spotify API responses before considering the request failed; adjust based on expected network conditions and API responsiveness
TIMEOUT_SEC=3
# Polling interval to check Spotify's playback state when it's the active service; set to 0 to disable polling and rely solely on WebSocket events (not recommended for Spotify as it can miss state changes)
POLL_INTERVAL_SEC=3
# Retry logic when Spotify API calls fail: how long to wait before retrying, how long to keep retrying before giving up and switching to fallback, and how long to wait during cooldown periods between retry cycles. Adjust based on expected API reliability and desired responsiveness to failures.
RETRY_INTERVAL_SEC=3
# If Spotify API calls have been failing for this long, switch to fallback service; set to 0 = retry indefinitely before cooldown cycles
RETRY_TIME_SEC=0 
# After giving up on Spotify due to repeated failures, wait this long before allowing retries again. Set to 0 to allow immediate retries after giving up.
RETRY_COOLDOWN_SEC=7
# If Spotify reports failure, wait this long before switching to the next service in the priority list. This can help avoid unnecessary cycling if the user may be failing briefly. Adjust based on typical user behavior.
FALLBACK_TIMEOUT_SEC=3
# If Spotify API calls are failing, automatically switch to the next service in the priority list after FALLBACK_TIMEOUT_SEC. Set to true to enable automatic fallback on errors, or false to stay on the service and keep retrying without falling back.
FALLBACK_ON_ERROR=true
# If Spotify API calls have been failing for this many consecutive times, trigger fallback to the next service in the priority list. Adjust based on expected failure patterns and desired sensitivity to errors.
FALLBACK_ERROR_THRESHOLD=3
# If Spotify reports failure for this long, automatically switch to the next service in the priority list. This can help avoid unnecessary cycling if the user may be failing briefly. Adjust based on typical user behavior.
FALLBACK_TIME_THRESHOLD_SEC=10 # 0 = disable

# =============================================================================
# Cloud Spotify Configuration: API endpoints, timeouts, retry logic, etc.
# =============================================================================
[CloudSpotify]
POLL_INTERVAL_SEC=3
FALLBACK_TIMEOUT_SEC=3
FALLBACK_ON_ERROR=true
FALLBACK_ERROR_THRESHOLD=3
FALLBACK_TIME_THRESHOLD_SEC=10 # 0 = disable
RETRY_INTERVAL_SEC=0 # 0/blank to disable client probe and rely on server health
RETRY_TIME_SEC=300
RETRY_COOLDOWN_SEC=7

# =============================================================================
# Local Sonos Configuration: API endpoints, timeouts, retry logic, etc.
# =============================================================================
[LocalSonos]
POLL_INTERVAL_SEC=0  # 0 = use server default
FALLBACK_TIMEOUT_SEC=0 # event-driven; rely on websocket errors
FALLBACK_ON_ERROR=true
FALLBACK_ERROR_THRESHOLD=3
FALLBACK_TIME_THRESHOLD_SEC=10 # 0 = disable
RETRY_INTERVAL_SEC=0 # 0/blank to disable client probe and rely on server health
RETRY_TIME_SEC=300
RETRY_COOLDOWN_SEC=10
PAUSED_WAIT_SEC=0
STOPPED_WAIT_SEC=3
IDLE_WAIT_SEC=3

# =============================================================================
# Native Local Sonos Configuration: API endpoints, timeouts, retry logic, etc.
# =============================================================================
[NativeLocalSonos]
# Event-driven; 0 lets bridge choose optimal polling interval based on its own Sonos discovery and event handling capabilities. Recommended to leave at 0 unless you have specific reasons to adjust it, as the native bridge is designed to minimize unnecessary polling while still providing timely updates.
POLL_INTERVAL_SEC=0

# Poll interval for track progess
TRACK_PROGRESS_POLL_INTERVAL_SEC=2

FALLBACK_TIMEOUT_SEC=0
FALLBACK_ON_ERROR=true
FALLBACK_ERROR_THRESHOLD=3
# 0 = disable time-based fallback and rely solely on error-based fallback; adjust based on desired sensitivity to service failures and user behavior patterns
FALLBACK_TIME_THRESHOLD_SEC=10

RETRY_INTERVAL_SEC=5
RETRY_TIME_SEC=30
RETRY_COOLDOWN_SEC=10

# Wait times in seconds for each Sonos transport state before cycling to next service
# Set to 0 to disable cycling for that state (stay on Sonos)
PAUSED_WAIT_SEC=0

STOPPED_WAIT_SEC=3
IDLE_WAIT_SEC=3

# How often to check if native Sonos bridge is healthy (0 to disable periodic checks; fallback relies solely on error thresholds and cooldowns)
HEALTH_CHECK_SEC=10

# Number of consecutive failed health checks before marking native Sonos bridge as unhealthy and falling back to next service. Health check failures contribute to fallback thresholds, but not retry cooldowns (since they're not necessarily indicative of a persistent issue that would be resolved by waiting). Set to 0 to disable health check failures from contributing to fallback thresholds, relying solely on real-time errors for fallback decisions. Note: if health checks are disabled, the system will rely entirely on real-time errors and fallback thresholds to determine when to fall back from native Sonos, which may result in slower fallback if the bridge becomes unresponsive without generating errors.
HEALTH_CHECK_RETRY=3

# Timeout for health check
HEALTH_CHECK_TIMEOUT_SEC=10
# Method for Sonos coordinator discovery for native local Sonos bridge. Options:
# - Default: "lmp_zgs" (Live Media Progress then Zone Group State): uses live media progress to get the coordinator UUID, then looks up the UUID in the zone group state for the coordinator's IP and display name. This is more direct and typically more reliable for identifying the coordinator.
# - "zgs_lmp" (Zone Group State then Live Media Progress): uses ZoneGroupState to find the coordinator, then fetches live media progress as an additional data point to validate the coordinator.
COORDINATOR_DISC_METHOD=lmp_zgs

# Maximum number of hosts to check for Sonos coordinator during discovery. This is a client-side limit for the native local Sonos bridge and does not affect the backend Sonos discovery, which will still find all Sonos devices on the network. If the native bridge supports multiple Sonos hosts, it should ideally return an error if the coordinator isn't found within this limit. Set to 0 to disable this limit and allow the native bridge to check all discovered hosts (not recommended unless you have a large number of Sonos devices and are experiencing issues with coordinator discovery).
MAX_HOSTS_PER_COORDINATOR_DISC=5

[NowPlayingHomeWidget]
# Enable track progress process
ENABLE_TRACK_PROGRESS=true