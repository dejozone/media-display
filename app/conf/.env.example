# Copy to app/assets/env/.env for local development
FLAVOR=dev
API_BASE_URL=http://localhost:5001
API_SSL_VERIFY=true

EVENTS_WS_URL=wss://localhost:5002/events/media
WS_RETRY_INTERVAL_MS=3000
WS_RETRY_ACTIVE_SECONDS=60
WS_RETRY_COOLDOWN_SECONDS=60
WS_RETRY_MAX_TOTAL_SECONDS=1800
EVENTS_WS_SSL_VERIFY=true

SPOTIFY_POLL_INTERVAL_SEC=3
# SONOS_POLL_INTERVAL_SEC=10  # Optional; unset means default server/SDK interval
MAX_AVATARS_PER_USER=6

WS_RETRY_INTERVAL_MS=3000
WS_RETRY_ACTIVE_SECONDS=60
WS_RETRY_COOLDOWN_SECONDS=180
WS_RETRY_MAX_TOTAL_SECONDS=1800
WS_FORCE_RECONN_IDLE_SEC=300

# Direct Spotify polling configuration
SPOTIFY_DIRECT_API_BASE_URL=https://api.spotify.com/v1
SPOTIFY_DIRECT_POLL_INTERVAL_SEC=3
SPOTIFY_DIRECT_RETRY_INTERVAL_SEC=3
SPOTIFY_DIRECT_RETRY_WINDOW_SEC=10
SPOTIFY_DIRECT_COOLDOWN_SEC=30
SPOTIFY_DIRECT_API_SSL_VERIFY=true

# =============================================================================
# Service Priority Configuration
# =============================================================================

# Priority order of services (comma-separated)
# Options: direct_spotify, cloud_spotify, local_sonos
# First service in list = primary, subsequent = fallbacks in order
# Services are filtered by user settings (Spotify/Sonos enabled)
PRIORITY_ORDER_OF_SERVICES=local_sonos,direct_spotify,cloud_spotify

# Direct Spotify Fallback Configuration
# Triggers fallback when direct Spotify polling fails
SPOTIFY_DIRECT_FALLBACK_TIMEOUT_SEC=5
SPOTIFY_DIRECT_FALLBACK_ON_ERROR=true
SPOTIFY_DIRECT_FALLBACK_ERROR_THRESHOLD=3

# Direct Spotify Retry Configuration (when on fallback, retry primary)
SPOTIFY_DIRECT_RETRY_INTERVAL_SEC=10
SPOTIFY_DIRECT_RETRY_COOLDOWN_SEC=30
SPOTIFY_DIRECT_RETRY_MAX_WINDOW_SEC=300

# Cloud Spotify (WebSocket) Fallback Configuration
# Backend polls Spotify API at regular intervals, so timeout is enabled
CLOUD_SPOTIFY_FALLBACK_TIMEOUT_SEC=3
CLOUD_SPOTIFY_FALLBACK_ON_ERROR=true
CLOUD_SPOTIFY_FALLBACK_ERROR_THRESHOLD=3

# Cloud Spotify Retry Configuration
CLOUD_SPOTIFY_RETRY_INTERVAL_SEC=10
CLOUD_SPOTIFY_RETRY_COOLDOWN_SEC=30
CLOUD_SPOTIFY_RETRY_MAX_WINDOW_SEC=300

# Local Sonos (WebSocket) Fallback Configuration
# NOTE: Sonos is EVENT-DRIVEN (only emits on state change), so timeout is DISABLED (0)
# Fallback for Sonos relies on WebSocket connection errors, not data timeout
LOCAL_SONOS_FALLBACK_TIMEOUT_SEC=0
LOCAL_SONOS_FALLBACK_ON_ERROR=true
LOCAL_SONOS_FALLBACK_ERROR_THRESHOLD=3

# Local Sonos Retry Configuration
LOCAL_SONOS_RETRY_INTERVAL_SEC=10
LOCAL_SONOS_RETRY_COOLDOWN_SEC=30
LOCAL_SONOS_RETRY_MAX_WINDOW_SEC=300

# =============================================================================
# Service Cycling Configuration
# =============================================================================
# When a service reports "not playing", automatically try the next service
# in the priority list. After all services are checked, return to the first
# and wait before cycling again.

# Enable automatic service cycling when a service reports not playing
ENABLE_SERVICE_CYCLING=true

# Sonos state-based fallback configuration
# Wait times in seconds for each Sonos transport state before cycling to next service
# Set to 0 to disable cycling for that state (stay on Sonos)
# Note: PLAYING and TRANSITIONING never trigger cycling
LOCAL_SONOS_PAUSED_WAIT_SEC=0         # 0 = don't cycle when user pauses (they'll likely resume)
LOCAL_SONOS_STOPPED_WAIT_SEC=30       # Wait 30s after stopped before cycling
LOCAL_SONOS_IDLE_WAIT_SEC=3           # Quick cycle when idle/no media

# How long to wait after Spotify reports paused before switching to next service
SPOTIFY_PAUSED_WAIT_SEC=5

# After checking all services and none are playing, wait this long before cycling again
SERVICE_CYCLE_RESET_SEC=30

# Global Service Settings
# Grace period during service transitions to avoid UI flicker
SERVICE_TRANSITION_GRACE_SEC=2
# Max time to wait for token before fallback
TOKEN_WAIT_TIMEOUT_SEC=10
