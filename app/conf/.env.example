# Copy to app/assets/env/.env for local development

# =============================================================================
# General Server Configuration
# =============================================================================

# Environment flavor: dev or prod
FLAVOR=dev
LOG_LEVEL=INFO # ALL, DEBUG, INFO, WARNING, SEVERE, OFF
API_BASE_URL=http://localhost:5001
API_SSL_VERIFY=true
# Maximum number of avatars per user
MAX_AVATARS_PER_USER=6
# How long to wait after Spotify reports paused before switching to next service
SPOTIFY_PAUSED_WAIT_SEC=5
# After checking all services and none are playing, wait this long before cycling again
SERVICE_CYCLE_RESET_SEC=7
# Grace period during service transitions to avoid UI flicker
SERVICE_TRANSITION_GRACE_SEC=2

# The time to wait before resetting all services when music hasn't been playing. Set to 0 to disable reseting on idle.
SERVICE_IDLE_CYCLE_RESET_SEC=300
# If a service reports "not playing" for this long, reset all services and start discovery over. This is a safety net in case the server misses a "playing" event or a service gets stuck in a bad state.
SERVICE_IDLE_TIME_SEC=360 # Best to set the time longer than a typical song duration (< 6 minutes to avoid false positives, but ideally not much longer than average song length of ~3-4 minutes)

# =============================================================================
# Service Priority Configuration
# =============================================================================

# Priority order of services (platform-aware)
# Default mode (non-web fallback) supports direct/cloud Spotify only
DEF_PRIORITY_ORDER_OF_SERVICES=direct_spotify,cloud_spotify

# Platform-specific overrides (only the listed services are used for that platform)
WEB_PRIORITY_ORDER_OF_SERVICES=direct_spotify,cloud_spotify
MACOS_PRIORITY_ORDER_OF_SERVICES=native_local_sonos,direct_spotify,cloud_spotify
WINDOWS_PRIORITY_ORDER_OF_SERVICES=native_local_sonos,local_sonos,direct_spotify,cloud_spotify
LINUX_PRIORITY_ORDER_OF_SERVICES=native_local_sonos,local_sonos,direct_spotify,cloud_spotify
ANDROID_PRIORITY_ORDER_OF_SERVICES=native_local_sonos,direct_spotify,cloud_spotify
IOS_PRIORITY_ORDER_OF_SERVICES=native_local_sonos,direct_spotify,cloud_spotify
EMBEDDED_PRIORITY_ORDER_OF_SERVICES=native_local_sonos,local_sonos,direct_spotify,cloud_spotify

# =============================================================================
# Service Cycling Configuration
# =============================================================================
# When a service reports "not playing", automatically try the next service
# in the priority list. After all services are checked, return to the first
# and wait before cycling again.

# Enable automatic service cycling when a service reports not playing
ENABLE_SERVICE_CYCLING=true

# =============================================================================
# WebSocket Configuration
# =============================================================================

WS_BASE_URL=ws://localhost:5002/events/media
WS_SSL_VERIFY=true
WS_RETRY_INTERVAL_MS=3000
WS_RETRY_ACTIVE_SEC=60
WS_RETRY_WINDOW_SEC=1800 # 0 = retry indefinitely
WS_RETRY_COOLDOWN_SEC=180
WS_FORCE_RECONN_IDLE_SEC=300

# =============================================================================
# Direct Spotify Configuration
# =============================================================================

DIRECT_SPOTIFY_API_BASE_URL=https://api.spotify.com/v1
DIRECT_SPOTIFY_TIMEOUT_SEC=3
DIRECT_SPOTIFY_POLL_INTERVAL_SEC=3
DIRECT_SPOTIFY_RETRY_INTERVAL_SEC=3
DIRECT_SPOTIFY_RETRY_COOLDOWN_SEC=7
DIRECT_SPOTIFY_RETRY_WINDOW_SEC=0
DIRECT_SPOTIFY_RETRY_TIME_SEC=0 # 0 = retry indefinitely before cooldown cycles
DIRECT_SPOTIFY_API_SSL_VERIFY=true
# Triggers fallback when direct Spotify polling fails
DIRECT_SPOTIFY_FALLBACK_TIMEOUT_SEC=3
DIRECT_SPOTIFY_FALLBACK_ON_ERROR=true
DIRECT_SPOTIFY_FALLBACK_ERROR_THRESHOLD=3
DIRECT_SPOTIFY_FALLBACK_TIME_THRESHOLD_SEC=10 # 0 = disable

# =============================================================================
# Cloud Spotify Configuration
# =============================================================================

CLOUD_SPOTIFY_POLL_INTERVAL_SEC=3
# Backend polls Spotify API at regular intervals, so timeout is enabled
CLOUD_SPOTIFY_FALLBACK_TIMEOUT_SEC=3
CLOUD_SPOTIFY_FALLBACK_ON_ERROR=true
CLOUD_SPOTIFY_FALLBACK_ERROR_THRESHOLD=3
CLOUD_SPOTIFY_FALLBACK_TIME_THRESHOLD_SEC=10 # 0 = disable
# Cloud Spotify Retry Configuration
CLOUD_SPOTIFY_RETRY_INTERVAL_SEC=0 # 0/blank to disable client probe and rely on server health
CLOUD_SPOTIFY_RETRY_COOLDOWN_SEC=10
CLOUD_SPOTIFY_RETRY_WINDOW_SEC=300
CLOUD_SPOTIFY_RETRY_TIME_SEC=300

# =============================================================================
# Local Sonos Configuration
# =============================================================================

LOCAL_SONOS_POLL_INTERVAL_SEC=0  # 0 = use server default
# NOTE: Sonos is EVENT-DRIVEN (only emits on state change), so timeout is DISABLED (0)
# Fallback for Sonos relies on WebSocket connection errors, not data timeout
LOCAL_SONOS_FALLBACK_TIMEOUT_SEC=0
LOCAL_SONOS_FALLBACK_ON_ERROR=true
LOCAL_SONOS_FALLBACK_ERROR_THRESHOLD=3
LOCAL_SONOS_FALLBACK_TIME_THRESHOLD_SEC=10 # 0 = disable
# Local Sonos Retry Configuration
LOCAL_SONOS_RETRY_INTERVAL_SEC=60 # 0/blank to disable client probe and rely on server health
LOCAL_SONOS_RETRY_COOLDOWN_SEC=10
LOCAL_SONOS_RETRY_WINDOW_SEC=300
LOCAL_SONOS_RETRY_TIME_SEC=300
# Wait times in seconds for each Sonos transport state before cycling to next service
# Set to 0 to disable cycling for that state (stay on Sonos)
# Note: PLAYING and TRANSITIONING never trigger cycling
LOCAL_SONOS_PAUSED_WAIT_SEC=0         # 0 = don't cycle when user pauses (they'll likely resume)
LOCAL_SONOS_STOPPED_WAIT_SEC=3       # Wait 3s after stopped before cycling
LOCAL_SONOS_IDLE_WAIT_SEC=3           # Quick cycle when idle/no media

# =============================================================================
# Native Local Sonos (on-device bridge) Configuration
# =============================================================================
# If enabled, the app will try to use a native/platform Sonos bridge instead of the
# backend WebSocket for Sonos. Defaults mirror Local Sonos, but are separate so you
# can tune client-side behavior independently. On web, this is ignored/not supported.

NATIVE_LOCAL_SONOS_POLL_INTERVAL_SEC=0  # Event-driven; 0 lets bridge choose
# NOTE: Native Sonos is expected to be event-driven; keep timeout at 0 unless the
# bridge explicitly supports a heartbeat/poll.
NATIVE_LOCAL_SONOS_FALLBACK_TIMEOUT_SEC=0
NATIVE_LOCAL_SONOS_FALLBACK_ON_ERROR=true
NATIVE_LOCAL_SONOS_FALLBACK_ERROR_THRESHOLD=3
NATIVE_LOCAL_SONOS_FALLBACK_TIME_THRESHOLD_SEC=10
NATIVE_LOCAL_SONOS_RETRY_INTERVAL_SEC=5
NATIVE_LOCAL_SONOS_RETRY_TIME_SEC=300
NATIVE_LOCAL_SONOS_RETRY_COOLDOWN_SEC=60
NATIVE_LOCAL_SONOS_RETRY_WINDOW_SEC=0
# Wait times in seconds for each Sonos transport state before cycling to next service
# Set to 0 to disable cycling for that state (stay on Sonos)
NATIVE_LOCAL_SONOS_PAUSED_WAIT_SEC=0
NATIVE_LOCAL_SONOS_STOPPED_WAIT_SEC=3
NATIVE_LOCAL_SONOS_IDLE_WAIT_SEC=3